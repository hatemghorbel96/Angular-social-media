<!-- Container START -->
<div class="container">
    <div class="row gx-0">
        <!-- Sidebar START -->
        <div class="col-lg-4 col-xxl-3" id="chatTabs" role="tablist">

            <!-- Divider -->
            <div class="d-flex align-items-center mb-4 d-lg-none">
                <button class="border-0 bg-transparent" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                    <i class="btn btn-primary fw-bold fa-solid fa-sliders"></i>
                    <span class="h6 mb-0 fw-bold d-lg-none ms-2">Chats</span>
                </button>
            </div>
            <!-- Advanced filter responsive toggler END -->
            <div class="card card-body border-end-0 border-bottom-0 rounded-bottom-0">
                <div class=" d-flex justify-content-between align-items-center">
                    <h1 class="h5 mb-0">Active chats <span class="badge bg-success bg-opacity-10 text-success">6</span>
                    </h1>
                    <!-- Chat new create message item START -->
                    <div class="dropend position-relative">
                        <div class="nav">
                            <a class="icon-md rounded-circle btn btn-sm btn-primary-soft nav-link toast-btn"
                                data-target="chatToast" href="#"> <i class="bi bi-pencil-square"></i> </a>
                        </div>
                    </div>
                    <!-- Chat new create message item END -->
                </div>
            </div>

            <nav class="navbar navbar-light navbar-expand-lg mx-0">
                <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar">
                    <!-- Offcanvas header -->
                    <div class="offcanvas-header">
                        <button type="button" class="btn-close text-reset ms-auto" data-bs-dismiss="offcanvas"></button>
                    </div>

                    <!-- Offcanvas body -->
                    <div class="offcanvas-body p-0">
                        <div class="card card-chat-list rounded-end-lg-0 card-body border-end-lg-0 rounded-top-0">

                            <!-- Search chat START -->
                            <form class="position-relative">
                                <input class="form-control py-2" type="search" placeholder="Search for chats"
                                    aria-label="Search">
                                <button
                                    class="btn bg-transparent text-secondary px-2 py-0 position-absolute top-50 end-0 translate-middle-y"
                                    type="submit">
                                    <i class="bi bi-search fs-5"></i>
                                </button>
                            </form>
                            <!-- Search chat END -->
                            <!-- Chat list tab START -->
                            <div class="mt-4 h-100">
                                <div class="chat-tab-list custom-scrollbar">
                                    <ul class="nav flex-column nav-pills nav-pills-soft">

                                        <li data-bs-dismiss="offcanvas" *ngFor="let chats of chatList">
                                            <!-- Chat user tab item -->
                                            <a (click)="loadChatByEmail(chats.secondUserName, chats.firstUserName)"  class="nav-link active text-start" id="chat-1-tab"
                                                data-bs-toggle="pill" role="tab">
                                                <div class="d-flex">


                                                    <div class="flex-shrink-0 avatar avatar-story me-2 status-online" *ngIf="chats.secondUserName!=senderCheck">
                                                       <!--  <img class="avatar-img rounded-circle"
                                                            src ="{{this.userService.host+'/social/api/profilphoto/'+m.id}}" alt=""> -->
                                                            
                                                                <img class="avatar-img rounded-circle"  alt="">
                                                                   
                                                           
                                                    </div>
                                                    <div class="flex-grow-1 d-block" *ngIf="chats.secondUserName!=senderCheck">
                                                        <h6 class="mb-0 mt-1">{{chats.secondUserName}}</h6>
                                                        <div class="small text-secondary">{{chats.secondUserName}} sent 1 a photo.</div>
                                                    </div>


                                                    <div class="flex-shrink-0 avatar avatar-story me-2 status-online" *ngIf="chats.secondUserName==senderCheck">
                                                   
                                                        <img class="avatar-img rounded-circle" alt="">
                                                    
                                                    </div>
                                                    <div class="flex-grow-1 d-block" *ngIf="chats.secondUserName==senderCheck">
                                                        <h6 class="mb-0 mt-1">{{chats.firstUserName}}</h6>
                                                        <div class="small text-secondary">{{chats.firstUserName}} sent a photo.</div>
                                                    </div>

                                                    
                                                </div>
                                            </a>
                                        </li>
                                      
                                    </ul>
                                </div>
                            </div>
                            <!-- Chat list tab END -->
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <!-- Sidebar START -->

        <!-- Chat conversation START -->
        <div class="col-lg-8 col-xxl-9">
            <div class="card card-chat rounded-start-lg-0 border-start-lg-0">
                <div class="card-body h-100 mb-5 ">
                    <div class="tab-content py-3 mb-5 h-100" id="chatTabsContent">
                        <!-- Conversation item START -->
                        <div class="fade tab-pane show active h-100" id="chat-1" role="tabpanel"
                            aria-labelledby="chat-1-tab">
                            <!-- Top avatar and status START -->
                            <div class="d-sm-flex justify-content-between align-items-center">
                                <div class="d-flex mb-2 mb-sm-0">
                                    <div class="flex-shrink-0 avatar me-2" >
                                        <label *ngFor="let u of users">
                                        <img class="avatar-img rounded-circle" src ="{{this.userService.host+'/social/api/profilphoto/'+u.id}}" alt="" *ngIf="u.username==secondUserName">
                                        </label>
                                    </div>
                                    <div class="d-block flex-grow-1" *ngIf="secondUserName!=senderCheck">
                                        <h6 class="mb-0 mt-1">{{secondUserName}}</h6>
                                        <div class="small text-secondary"><i
                                                class="fa-solid fa-circle text-success me-1"></i>Online</div>
                                    </div>

                                    <div class="d-block flex-grow-1" *ngIf="secondUserName==senderCheck">
                                        <h6 class="mb-0 mt-1">{{firstUserName}}</h6>
                                        <div class="small text-secondary"><i class="fa-solid fa-circle text-success me-1"></i>Online</div>
                                    </div>
                                </div>
                               
                            </div>
                            <!-- Top avatar and status END -->
                            <hr>
                            <!-- Chat conversation START -->
                            <ng-scrollbar  #scrollable  class="chat-conversation-content custom-scrollbar">
                                <!-- Chat time -->
                               
                                <div class="text-center small my-2">Jul 16, 2022, 06:15 am</div>
                                <!-- Chat message left -->

                                <div *ngFor="let msg of sortData()">

                                <div class="d-flex mb-1" *ngIf="msg.senderEmail!=senderCheck">
                                    <div class="flex-shrink-0 avatar avatar-xs me-2">
                                        <label *ngFor="let u of users">
                                            <img class="avatar-img rounded-circle" src="{{this.userService.host+'/social/api/profilphoto/'+u.id}}" alt=""
                                                *ngIf="u.username==secondUserName">
                                        </label>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="w-100">
                                            <div class="d-flex flex-column align-items-start">
                                                <div class="bg-light text-secondary p-2 px-3 rounded-2">{{msg.replymessage}}</div>
                                                <div class="small my-2">{{msg.time.substring(11,16)}}</div>
                                            </div>
                                        </div>
                                    </div>
                                   
                                </div>
                             
                          
                               
                                <!-- Chat message right -->
                                <div class="d-flex justify-content-end text-end mb-1" *ngIf="msg.senderEmail==senderCheck">
                                    <div class="w-100">
                                        <div>
                                           <!--  <div playAudio()></div> -->
                                        </div>
                                        
                                        <div class="d-flex flex-column align-items-end">
                                            <div class="bg-primary text-white p-2 px-3 rounded-2">{{msg.replymessage}}</div>
                                            <!-- Images -->
                                            <div class="d-flex my-2">
                                                <div class="small text-secondary">{{msg.time.substring(11,16)}}</div>
                                                <div class="small ms-2"><i class="fa-solid fa-check"></i></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Chat message right -->
                               </div>
                              
                            
                            </ng-scrollbar>
                            <!-- Chat conversation END -->
                        </div>
                     
                        <!-- Conversation item END -->
                    </div>
                </div>
                
                <div class="card-footer">
                    <form [formGroup]="chatForm" class="d-sm-flex align-items-end">
                        <textarea class="form-control mb-sm-0 mb-3 mt-5" data-autoresize placeholder="Type a message"
                            rows="1"  formControlName="replymessage" (keyup.enter)="sendMessage()" [(ngModel)]="message"></textarea>
                            <div class="d-sm-flex align-items-end">
                                <emoji-mart class="emoji-mart" size="16" [set]="set" *ngIf="showEmojiPicker" (emojiSelect)="addEmoji($event)"
                                    title="Pick your emojiâ€¦"></emoji-mart>
                            </div>
                        <button class="btn btn-sm btn-danger-soft ms-sm-2" (click)="toggleEmojiPicker()"><i class="fa-solid fa-face-smile fs-6"></i></button>
                      <!--   <button class="btn btn-sm btn-secondary-soft ms-2"><i class="fa-solid fa-paperclip fs-6"></i></button> -->
                        <button class="btn btn-sm btn-primary ms-2" (click)="sendMessage()"><i
                                class="fa-solid fa-paper-plane fs-6"></i></button>

                               
                              
                    </form>
                </div>

               
            </div>
           
        </div>
        <!-- Chat conversation END -->
    </div> <!-- Row END -->
    <!-- =======================
    Chat END -->

</div>
<!-- Container END -->


